{% load widget_tweaks %}
 
<div class="grid grid-cols-3">
    <div class="flex justify-center">
        <a href="{% url 'transactions_list' pk=account.pk %}" class="btn">Go back</a>
    </div>
    <div>
        <h1 class="text-center text-4xl xl:text-4xl">Assign Money to the Account {{account}}</h1>
        <h3 id="balance" class="text-center text-success text-2xl xl:text-2xl">{{account.currency.code}} {{account.current_balance}}</h3>
    </div>
    <div class="flex justify-center">
    </div>
</div>

<input type="hidden" id="account_balance" name="account_balance" value="{{account.current_balance}}">

<form hx-post="{% url 'tag_assignment' pk=account.pk %}" hx-target="main" hx-select="main" class="grid grid-cols-1">
    {% csrf_token %}
    
    <div class="mb-3">
        <div class="overflow-x-auto">
            <table class="table text-center">
              <thead>
                <tr>
                  <th></th>
                  <th>Tag Name</th>
                  <th>Previous Assigned in the Account</th>
                  <th>Money to Assign</th>
                  <th>Current Total Assigned in Tag</th>
                  <th>Total Assigned in Tag after Changes</th>
                </tr>
              </thead>
              <tbody>
                {% for form in forms %}
                <tr>
                  <td>{{forloop.counter}}</td>
                  <td>
                    {{form.form.instance.tag}}
                    <input type="hidden" name="{{form.form.instance.tag.pk}}-id" value="{{form.form.instance.id}}">               
                  </td>
                  <td class="previous-assigned" id="previous-{{form.form.prefix}}">{{form.form.instance.amount}}</td>
                  <td class="money-to-assign">{% render_field form.form.amount class="input input-bordered w-full total" %}</td>
                  <td id="total-tag-before-{{form.form.prefix}}">{{form.total}}</td>
                  <td class="assigned-future" id="total-tag-after-{{form.form.prefix}}">{{form.total}}</td>
                </tr>
                {% endfor %}
                <tr>
                  <th colspan="2">Totals</th>
                  <td id="total-assigned-previous">{{totals.total_account}}</td>
                  <td id="total-assigned-now">{{totals.total_account}}</td>
                  <td id="total-assigned-tags-before">{{totals.total_tags}}</td>
                  <td id="total-assigned-tags-after">{{totals.total_tags}}</td>
                </tr>
                <tr>
                  <th colspan="5">Not Assigned in this Account</th>
                  <td id="not-assigned">{{totals.not_assigned}}</td>
                </tr>
              </tbody>
            </table>
          </div>
    </div>
    <div class="flex justify-center">
        <button type="submit" class="btn btn-primary">Register Assignment</button>
    </div>
</form>

<script type="text/javascript" src="/static/js/totals.js"></script>